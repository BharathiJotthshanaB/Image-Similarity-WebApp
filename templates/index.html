<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Image Similarity Checker</title>

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      width: 420px;
      text-align: center;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .container:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }

    h1 {
      margin-bottom: 20px;
      font-size: 26px;
      color: #fff;
    }

    /* DRAG & DROP AREA */
    .drop-zone {
      border: 2px dashed #aaa;
      border-radius: 10px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: 0.3s ease;
      margin-bottom: 15px;
    }

    .drop-zone:hover {
      border-color: #00f2fe;
      background: rgba(255, 255, 255, 0.15);
    }

    .preview {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .preview img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #fff;
    }

    input[type="submit"] {
      margin-top: 10px;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      border: none;
      color: white;
      font-size: 16px;
      padding: 10px 25px;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    input[type="submit"]:hover {
      background: linear-gradient(90deg, #00f2fe, #4facfe);
      transform: translateY(-2px);
    }

    /* Progress bar */
    .progress-container {
      position: relative;
      width: 100%;
      height: 25px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      overflow: hidden;
      margin-top: 20px;
    }

    #progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, red, yellow, green);
      border-radius: 15px;
      transition: width 1s ease-in-out;
    }

    #score-number {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, 0);
      color: #fff;
      font-weight: bold;
      font-size: 18px;
    }

    #score-text {
      margin-top: 10px;
      font-size: 15px;
      font-weight: 500;
    }

    /* Before/After comparison */
    .compare-container {
      margin-top: 25px;
      position: relative;
      width: 100%;
      overflow: hidden;
    }

    .compare-img {
      width: 100%;
      display: block;
      border-radius: 10px;
    }

    .slider {
      position: absolute;
      width: 3px;
      background: #fff;
      top: 0;
      bottom: 0;
      cursor: ew-resize;
    }

    .footer {
      margin-top: 25px;
      font-size: 12px;
      color: #eee;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üß† AI Image Similarity Checker</h1>

    <form id="upload-form" method="POST" enctype="multipart/form-data">
      <div class="drop-zone" id="drop1">Drop or Select Image 1
        <input type="file" name="image1" id="image1" required hidden />
        <div class="preview" id="preview1"></div>
      </div>
      <div class="drop-zone" id="drop2">Drop or Select Image 2
        <input type="file" name="image2" id="image2" required hidden />
        <div class="preview" id="preview2"></div>
      </div>
      <input type="submit" value="Compare">
    </form>

    {% if score is not none %}
      <div class="progress-container">
        <div id="progress-bar"></div>
        <span id="score-number">0.00</span>
      </div>

      <p id="score-text">
        {% if score >= 0.8 %}
          ‚úÖ These images are very similar ({{ (score*100)|round(1) }}%)
        {% elif score >= 0.4 %}
          ‚ö†Ô∏è These images share some resemblance ({{ (score*100)|round(1) }}%)
        {% else %}
          ‚ùå These images look different ({{ (score*100)|round(1) }}%)
        {% endif %}
      </p>

      <!-- Before/After visual -->
      <div class="compare-container" id="compare">
        <img src="{{ url_for('static', filename='uploads/' + img1) }}" class="compare-img" id="img1-display">
        <img src="{{ url_for('static', filename='uploads/' + img2) }}" class="compare-img" id="img2-display" style="position:absolute; left:0; top:0; clip-path:inset(0 50% 0 0);">
        <div class="slider" id="slider" style="left:50%;"></div>
      </div>

      <script>
        // Animate progress bar and score
        const progressBar = document.getElementById('progress-bar');
        const scoreNumber = document.getElementById('score-number');
        const scoreValue = {{ score|round(3) }};
        const percentage = scoreValue * 100;
        progressBar.style.width = percentage + '%';

        // Animate number
        let displayScore = 0;
        const interval = setInterval(() => {
          displayScore += 0.01;
          if (displayScore >= scoreValue) {
            displayScore = scoreValue;
            clearInterval(interval);
          }
          scoreNumber.innerText = displayScore.toFixed(2);
        }, 15);

        // Dynamic bar color
        let color;
        if (scoreValue < 0.4) color = "linear-gradient(90deg, red, orange)";
        else if (scoreValue < 0.8) color = "linear-gradient(90deg, orange, yellow)";
        else color = "linear-gradient(90deg, lightgreen, green)";
        progressBar.style.background = color;

        // Comparison slider
        const slider = document.getElementById("slider");
        const img2 = document.getElementById("img2-display");
        const compare = document.getElementById("compare");
        let isDragging = false;

        slider.addEventListener("mousedown", () => (isDragging = true));
        window.addEventListener("mouseup", () => (isDragging = false));
        window.addEventListener("mousemove", (e) => {
          if (!isDragging) return;
          const rect = compare.getBoundingClientRect();
          const offset = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
          slider.style.left = offset + "px";
          img2.style.clipPath = `inset(0 ${rect.width - offset}px 0 0)`;
        });
      </script>
    {% endif %}

    <div class="footer">
      Built with ‚ù§Ô∏è Flask + PyTorch + JavaScript
    </div>
  </div>

  <script>
    // Drag & Drop for images
    function setupDropZone(dropId, inputId, previewId) {
      const drop = document.getElementById(dropId);
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);

      drop.addEventListener("click", () => input.click());
      drop.addEventListener("dragover", (e) => {
        e.preventDefault();
        drop.style.borderColor = "#00f2fe";
      });
      drop.addEventListener("dragleave", () => {
        drop.style.borderColor = "#aaa";
      });
      drop.addEventListener("drop", (e) => {
        e.preventDefault();
        input.files = e.dataTransfer.files;
        showPreview(input, preview);
      });
      input.addEventListener("change", () => showPreview(input, preview));
    }

    function showPreview(input, preview) {
      preview.innerHTML = "";
      const file = input.files[0];
      if (file) {
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      }
    }

    setupDropZone("drop1", "image1", "preview1");
    setupDropZone("drop2", "image2", "preview2");
  </script>
</body>
</html>
